<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>طلب فتح جهاز</title>
  <style>
    body {font-family:Arial;background:#f3f3f3;padding:20px;direction:rtl;}
    form {background:#fff;padding:20px;border-radius:10px;max-width:400px;margin:auto;}
    input,select,button {width:100%;padding:10px;margin:10px 0;font-size:16px;border-radius:6px;border:1px solid #ccc;}
    button {background:#2ecc71;color:white;border:none;cursor:pointer;}
    table {width:100%;margin-top:20px;background:#fff;border-collapse:collapse;}
    th,td {border:1px solid #ccc;padding:10px;text-align:center;}
    th {background:#2ecc71;color:#fff;}
  </style>
</head>
<body>
  <h2>إرسال طلب فتح جهاز</h2>
  <form id="requestForm">
    <input type="text" id="senderName" required placeholder="الاسم" />
    <select id="device" required>
      <option value="">-- اختر جهاز --</option>
      <option value="PC01">PC01</option><option value="PC02">PC02</option><option value="PC03">PC03</option>
      <option value="PC04">PC04</option><option value="PC05">PC05</option>
    </select>
    <button type="submit">إرسال</button>
  </form>
  <div id="statusMessage"></div>
  <table id="requestsTable">
    <thead><tr><th>الاسم</th><th>الجهاز</th><th>الوقت</th><th>الحالة</th></tr></thead>
    <tbody></tbody>
  </table>

  <script type="module">
    // Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDLGPZq3_iDOus8jNe3RJ5ARiB3JAyLSz0",
      authDomain: "pc-club-89272.firebaseapp.com",
      databaseURL: "https://pc-club-89272-default-rtdb.firebaseio.com",
      projectId: "pc-club-89272",
      storageBucket: "pc-club-89272.firebasestorage.app",
      messagingSenderId: "167526968749",
      appId: "1:167526968749:web:f57156a3095c9503838524",
      measurementId: "G-85MJR3FJ2Q"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const form = document.getElementById("requestForm");
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const sender = document.getElementById("senderName").value.trim();
      const device = document.getElementById("device").value;
      if (!sender || !device) return;
      push(ref(db, "requests"), {
        sender, device,
        time: new Date().toLocaleString(),
        status: "قيد الانتظار"
      });
      form.reset();
      document.getElementById("statusMessage").innerText = "تم إرسال الطلب ✅";
    });

    const tbody = document.querySelector("#requestsTable tbody");
    onValue(ref(db, "requests"), (snapshot) => {
      tbody.innerHTML = "";
      snapshot.forEach(child => {
        const req = child.val();
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${req.sender}</td><td>${req.device}</td><td>${req.time}</td><td>${req.status}</td>`;
        tbody.appendChild(tr);
      });
    });
  </script>
</body>
</html>
